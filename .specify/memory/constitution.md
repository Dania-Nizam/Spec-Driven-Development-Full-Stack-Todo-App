# Project Constitution: Evolution of Todo – Phase II Full-Stack Web Application

## 1. Preamble

We are building a multi-user Todo web application as Phase II of Hackathon II.

Goal: Demonstrate mastery of Spec-Driven Development, Reusable Intelligence, and modern full-stack architecture using AI (Claude Code) without writing any code manually.

This project simulates real-world software evolution: from simple task tracking to a cloud-native, multi-user, full-stack web application. We operate as Product Architects using AI to produce clear specifications and reliable implementations without boilerplate or manual coding.

## 2. Core Principles (Non-Negotiable – From Document Page 1-2)

### 2.1 Spec-Driven Development is mandatory

- Every feature, component, endpoint, and model MUST have a detailed Markdown spec in `/specs` before implementation.
- All code MUST be generated by Claude Code from approved specs.
- Manual coding is strictly prohibited — any violation results in immediate rejection.
- Specs must be refined until Claude Code produces correct output.

### 2.2 Reusable Intelligence

- Use subagents and defined skills for coordination and bonus +200 points.
- Orchestrator leads; all work flows through delegation and review.
- Reusable artifacts (specs, endpoint tables, schema definitions, UI state tables) MUST be written for one-shot implementation by downstream agents.

### 2.3 Clean Code & Best Practices

- Follow established Python (FastAPI) and Next.js best practices.
- Maintain a proper monorepo structure with clear separation of concerns.
- Prefer small, testable changes with explicit contracts and consistent naming.

## 3. Phase II Requirements (From Document Page 7)

- Implement all 5 Basic Level features in a web application:
  1. Add Task
  2. Delete Task
  3. Update Task
  4. View Task List
  5. Mark as Complete
- Multi-user support with data persistence in Neon Serverless PostgreSQL.
- Responsive frontend interface (mobile-first).
- Authentication using Better Auth with full JWT integration.

## 4. Technology Stack (Mandatory)

- Frontend: Next.js 16+ (App Router), TypeScript, Tailwind CSS, shadcn/ui
- Backend: FastAPI (Python), SQLModel ORM
- Database: Neon Serverless PostgreSQL
- Authentication: Better Auth + JWT (shared `BETTER_AUTH_SECRET`)
- Development: Claude Code + Spec-Kit Plus (strict spec-driven)

## 5. Security & User Isolation (Critical – Page 7-8)

- All API endpoints MUST be under: `/api/{user_id}/tasks/*`.
- Every request MUST include a valid JWT in `Authorization: Bearer <token>`.
- Backend MUST verify JWT, extract authenticated `user_id`, and filter ALL queries by that authenticated `user_id`.
- No user can ever access or modify another user's tasks (strict isolation).
- Return **401 Unauthorized** for missing/invalid token.

## 6. API Endpoints (Exact – Must Match Document)

### 6.1 Canonical path rules (to prevent drift)

- **No trailing slashes** are permitted on these endpoints. Requests with a trailing slash MUST return **404**.
- Completion endpoint path is exactly: `PATCH /api/{user_id}/tasks/{id}/complete` (no alternatives).

### 6.2 Authoritative API contract (in-repo)

- The **authoritative** API contract MUST live under `@specs/api/`.
- Authoritative file: `@specs/api/contract.md`.
- This constitution’s endpoint table MUST match the authoritative contract exactly.

### 6.3 Endpoints table (canonical)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/{user_id}/tasks` | List all tasks |
| POST | `/api/{user_id}/tasks` | Create a new task |
| GET | `/api/{user_id}/tasks/{id}` | Get task details |
| PUT | `/api/{user_id}/tasks/{id}` | Update a task |
| DELETE | `/api/{user_id}/tasks/{id}` | Delete a task |
| PATCH | `/api/{user_id}/tasks/{id}/complete` | Toggle completion |

### 6.4 Binding authorization + error semantics

- If the JWT is missing/invalid/expired: return **401 Unauthorized** with JSON:
  - `{ "error": "unauthorized" }`
- If `{user_id}` path parameter does not equal the authenticated user id derived from JWT: return **403 Forbidden** with JSON:
  - `{ "error": "user_id_mismatch" }`
- If a task `{id}` is not found for the authenticated user: return **404 Not Found** with JSON:
  - `{ "error": "not_found" }`

**Enforcement rule:** `{user_id}` in the path MUST match the authenticated user id derived from the JWT.

## 7. Agent System & Reusable Intelligence (For +200 Bonus)

- Orchestrator: Project lead and coordinator
- spec-manager: Owner of all specifications
- constitution-keeper: Strict enforcer of this constitution
- full-stack-frontend: Builds UI
- full-stack-backend: Builds API
- database-specialist: Designs schema
- auth-specialist: Implements JWT security

All work flows: **Plan → Spec → Constitution Review → Code Generation → Final Review**.

## 8. Monorepo Structure (From Page 9)

- `/specs/architecture.md`, `features/`, `api/`, `database/`, `ui/`
- `.spec-kit/config.yaml` (required; PRs missing this file are rejected)
- `/frontend/` → Next.js app
- `/backend/` → FastAPI app

## 9. Quality Standards

- Clean, production-ready code
- Responsive design (mobile, tablet, desktop)
- Error handling, loading states, user feedback
- Consistent design system (Tailwind + shadcn/ui)

## 10. Enforcement

- The constitution-keeper agent will review and approve/reject all specs and code.
- Any violation of this constitution results in rejection and required rework.
- Goal: Maximum score (150 points Phase II + bonuses) and Panaversity opportunity.

## 11. Phase III Updates: AI-Powered Conversational Chatbot

### 11.1 Phase III Goal

Build an integrated conversational AI chatbot on top of Phase II full-stack app, allowing natural language management of Todo lists (e.g., "Add a high-priority task to buy groceries tomorrow", "Reschedule my morning meetings to 2 PM", "Show my pending tasks"). The chatbot must implement all Basic, Intermediate, and Advanced Todo features via natural language processing.

### 11.2 Technology Stack Extensions

- Frontend: OpenAI ChatKit for conversational UI integration
- Backend: OpenAI Agents SDK for agent orchestration and tool calling
- Protocol: Official MCP SDK for Model Context Protocol (expose Todo operations as MCP tools/server for standardized integration and stateful conversations)
- Architecture: Central ChatbotOrchestratorAgent coordinates flow: NLP parsing → Auth check → Skill/tool calls → Response generation

### 11.3 Reusable Intelligence (Bonus +200)

- Define and use reusable Agent Skills (e.g., add_task_skill, update_task_skill, etc. in backend/agents/skills/todo_skills.py) registered in ChatbotOrchestratorAgent
- Reuse Phase II subagents (auth-specialist, database-specialist, etc.) where possible
- MCP SDK for conversation state persistence and tool exposure

### 11.4 Security & Authentication Extension

- All chatbot operations MUST respect Phase II JWT authentication (extract user_id from token/session, enforce isolation)
- No anonymous Todo access in chat - every operation must be authenticated
- MCP tools MUST securely wrap existing API endpoints with proper user isolation
- Binding rule: Chatbot MUST call backend REST API via skills (no direct DB access in chat logic)

### 11.5 User Experience & Error Handling

- Friendly, natural responses that handle ambiguities, follow-ups, and confirmations
- Support potential multi-language (Urdu) and voice integration for bonus features
- Proper error recovery and graceful degradation when skills fail

### 11.6 Development & Specification Requirements

- Strictly Spec-Driven – new specs in /specs/features/chatbot.md, /specs/agent-skills.md, etc.
- All code generated via Claude Code from refined specs
- New folders/files for agents/skills, MCP server (e.g., mcp/server.py with tools), ChatKit integration in frontend
- Monorepo extensions must maintain clear separation of concerns

### 11.7 Source of truth

- `.specify/memory/constitution.md` is the **sole authoritative** constitution.

This constitution is binding on all agents from January 07, 2026 onward.

This constitution is binding for all agents. Violations will be flagged.
